# Requirements Document - Local Analytics System

**المشروع:** بصير MVP  
**التاريخ:** 6 ديسمبر 2025  
**المؤلف:** فريق وكلاء تطوير مشروع بصير  
**الحالة:** ✅ نشط

---

## Introduction

نظام Analytics المحلي هو نظام لتتبع وتحليل استخدام التطبيق بطريقة تحترم خصوصية المستخدم بالكامل. جميع البيانات تُخزن محلياً على جهاز المستخدم، ولا يتم إرسال أي بيانات شخصية أو مالية إلى الخارج.

**المشكلة:**

- نحتاج insights لتحسين المنتج
- لكن نلتزم بمبدأ "الخصوصية أولاً"
- لا نريد تتبع المستخدمين أو جمع بياناتهم

**الحل:**
نظام analytics محلي بالكامل مع خيار opt-in لمشاركة metrics مجهولة.

---

## Glossary

- **Local Analytics**: تحليلات تُخزن وتُعالج محلياً على الجهاز
- **Opt-in Telemetry**: مشاركة اختيارية لبيانات مجهولة
- **Event**: حدث قابل للتتبع (مثل: إنشاء فاتورة)
- **Metric**: مقياس قابل للقياس (مثل: عدد الفواتير)
- **Session**: فترة استخدام واحدة للتطبيق
- **DAU**: Daily Active Users - المستخدمون النشطون يومياً
- **MAU**: Monthly Active Users - المستخدمون النشطون شهرياً
- **Retention**: معدل الاحتفاظ بالمستخدمين
- **Activation**: إكمال المستخدم لأول إجراء مهم

---

## Requirements

### Requirement 1: Local Event Tracking

**User Story:** كمطور، أريد تتبع الأحداث المهمة في التطبيق، حتى أفهم كيف يستخدم المستخدمون التطبيق.

#### Acceptance Criteria

1. WHEN يحدث event مهم (إنشاء فاتورة، إضافة عميل) THEN النظام SHALL يسجل Event محلياً مع timestamp
2. WHEN يتم تسجيل Event THEN النظام SHALL يحفظ نوع Event والمعلومات غير الشخصية فقط
3. WHEN يتم تسجيل Event THEN النظام SHALL لا يحفظ أي بيانات شخصية أو مالية
4. WHEN المستخدم يفتح التطبيق THEN النظام SHALL يسجل session start
5. WHEN المستخدم يغلق التطبيق THEN النظام SHALL يسجل session end ومدة الجلسة

### Requirement 2: Usage Metrics

**User Story:** كمطور، أريد قياس metrics الاستخدام الأساسية، حتى أقيّم نجاح المنتج.

#### Acceptance Criteria

1. WHEN المستخدم يستخدم التطبيق THEN النظام SHALL يحسب عدد الفواتير المُنشأة
2. WHEN المستخدم يستخدم التطبيق THEN النظام SHALL يحسب عدد العملاء المضافين
3. WHEN المستخدم يستخدم ميزة THEN النظام SHALL يسجل استخدام الميزة
4. WHEN المستخدم يكمل session THEN النظام SHALL يحسب مدة الجلسة
5. WHEN يمر يوم THEN النظام SHALL يحسب DAU محلياً

### Requirement 3: Feature Adoption Tracking

**User Story:** كمطور، أريد معرفة أي الميزات تُستخدم أكثر، حتى أركز على التحسينات المهمة.

#### Acceptance Criteria

1. WHEN المستخدم يستخدم ميزة لأول مرة THEN النظام SHALL يسجل first use
2. WHEN المستخدم يستخدم ميزة THEN النظام SHALL يزيد عداد استخدام الميزة
3. WHEN المستخدم يفتح شاشة THEN النظام SHALL يسجل الشاشة المفتوحة
4. WHEN المستخدم يكمل إجراء THEN النظام SHALL يسجل نجاح الإجراء
5. WHEN المستخدم يواجه خطأ THEN النظام SHALL يسجل نوع الخطأ (بدون تفاصيل شخصية)

### Requirement 4: Retention Calculation

**User Story:** كمطور، أريد حساب معدل الاحتفاظ، حتى أعرف إذا كان المستخدمون يعودون للتطبيق.

#### Acceptance Criteria

1. WHEN المستخدم يفتح التطبيق THEN النظام SHALL يسجل تاريخ آخر استخدام
2. WHEN يمر يوم THEN النظام SHALL يحسب إذا كان المستخدم نشط في Day 1
3. WHEN تمر 7 أيام THEN النظام SHALL يحسب إذا كان المستخدم نشط في Day 7
4. WHEN تمر 30 يوم THEN النظام SHALL يحسب إذا كان المستخدم نشط في Day 30
5. WHEN المستخدم يطلب الإحصائيات THEN النظام SHALL يعرض معدل الاحتفاظ الشخصي

### Requirement 5: Opt-in Telemetry

**User Story:** كمستخدم، أريد خيار مشاركة بيانات مجهولة، حتى أساعد في تحسين التطبيق.

#### Acceptance Criteria

1. WHEN المستخدم يكمل Onboarding THEN النظام SHALL يعرض خيار "مشاركة بيانات مجهولة"
2. WHEN المستخدم يوافق THEN النظام SHALL يحفظ الموافقة ويبدأ إرسال metrics مجهولة
3. WHEN المستخدم يرفض THEN النظام SHALL يحترم الرفض ولا يرسل أي بيانات
4. WHEN المستخدم يغير رأيه THEN النظام SHALL يسمح بتغيير الإعداد من Settings
5. WHEN يتم إرسال بيانات THEN النظام SHALL يرسل فقط metrics مجهولة (عدد الفواتير، الميزات المستخدمة)

### Requirement 6: Privacy Dashboard

**User Story:** كمستخدم، أريد رؤية ما يتم تتبعه، حتى أطمئن على خصوصيتي.

#### Acceptance Criteria

1. WHEN المستخدم يفتح Privacy Dashboard THEN النظام SHALL يعرض جميع البيانات المُتتبعة محلياً
2. WHEN المستخدم يطلب التفاصيل THEN النظام SHALL يشرح كل metric وما يعنيه
3. WHEN المستخدم يريد حذف البيانات THEN النظام SHALL يسمح بحذف جميع بيانات Analytics
4. WHEN المستخدم يحذف البيانات THEN النظام SHALL يحذفها نهائياً ولا يمكن استرجاعها
5. WHEN المستخدم يطلب تصدير البيانات THEN النظام SHALL يصدر البيانات كملف JSON

### Requirement 7: Performance Metrics

**User Story:** كمطور، أريد قياس أداء التطبيق، حتى أحسّن السرعة والاستجابة.

#### Acceptance Criteria

1. WHEN التطبيق يبدأ THEN النظام SHALL يقيس وقت البدء (startup time)
2. WHEN شاشة تُفتح THEN النظام SHALL يقيس وقت التحميل
3. WHEN عملية تُنفذ THEN النظام SHALL يقيس وقت التنفيذ
4. WHEN يحدث crash THEN النظام SHALL يسجل معلومات الـ crash (بدون بيانات شخصية)
5. WHEN المستخدم يواجه بطء THEN النظام SHALL يسجل الشاشة البطيئة

### Requirement 8: In-App Surveys

**User Story:** كمطور، أريد جمع feedback مباشر من المستخدمين، حتى أفهم احتياجاتهم.

#### Acceptance Criteria

1. WHEN المستخدم يكمل إجراء مهم THEN النظام SHALL يعرض استبيان قصير (1-2 سؤال) اختيارياً
2. WHEN المستخدم يجيب على الاستبيان THEN النظام SHALL يحفظ الإجابة محلياً
3. WHEN المستخدم يتخطى الاستبيان THEN النظام SHALL لا يعرضه مرة أخرى لنفس الإجراء
4. WHEN المستخدم يوافق على المشاركة THEN النظام SHALL يرسل الإجابات مجهولة
5. WHEN المستخدم يكمل استبيان THEN النظام SHALL يعرض شكر ومكافأة (ميزة مجانية مؤقتة)

---

## Non-Functional Requirements

### Privacy

- لا تخزين بيانات شخصية أو مالية
- جميع البيانات محلية بشكل افتراضي
- opt-in فقط للمشاركة
- شفافية كاملة في ما يُجمع

### Performance

- تأثير ضئيل على الأداء (< 1% CPU)
- حجم تخزين صغير (< 10MB)
- لا تأثير على battery life

### Security

- تشفير البيانات المحلية
- لا إرسال بيانات بدون موافقة
- حذف آمن للبيانات

### Scalability

- دعم ملايين الأحداث
- تنظيف تلقائي للبيانات القديمة (> 90 يوم)
- ضغط البيانات

---

**تم إعداده بواسطة:** فريق وكلاء تطوير مشروع بصير  
**التاريخ:** 6 ديسمبر 2025  
**الإصدار:** 1.0  
**الحالة:** ✅ جاهز للمراجعة
