# Requirements Document - بناء نظام الاختبارات

**المشروع:** بصير MVP  
**التاريخ:** 2 ديسمبر 2025  
**المؤلف:** فريق وكلاء تطوير مشروع بصير  
**الإصدار:** 1.1  
**الحالة:** معتمد

---

## Introduction

هذا المستند يحدد متطلبات بناء نظام اختبار شامل لتطبيق بصير. الهدف هو ضمان جودة الكود واستقراره من خلال اختبارات الوحدة (Unit Tests) واختبارات الـ Widgets، مع تحقيق تغطية لا تقل عن 70% من الكود. يهدف نظام الاختبارات إلى اكتشاف الأخطاء مبكراً، تسهيل الصيانة، وضمان استقرار التطبيق على المدى الطويل.

## Glossary

- **النظام (System)**: تطبيق بصير MVP بجميع مكوناته
- **Unit Test**: اختبار وحدة يختبر دالة أو class معزول عن التبعيات الخارجية
- **Widget Test**: اختبار يختبر widget واحد أو مجموعة widgets في بيئة محاكاة
- **Integration Test**: اختبار يختبر التطبيق بالكامل مع جميع مكوناته
- **Mock**: كائن وهمي يحاكي سلوك كائن حقيقي للاختبار
- **Repository**: طبقة الوصول للبيانات في معمارية التطبيق
- **Provider**: مزود Riverpod لإدارة الحالة في التطبيق
- **Test Coverage**: نسبة الكود المغطى بالاختبارات
- **Fixture**: بيانات ثابتة جاهزة للاستخدام في الاختبارات
- **Isar**: قاعدة البيانات المحلية المستخدمة في التطبيق

## Requirements

### Requirement 1

**User Story:** كمطور، أريد اختبارات وحدة للـ Repositories، حتى أتأكد من أن عمليات قاعدة البيانات تعمل بشكل صحيح.

#### Acceptance Criteria

1. WHEN اختبار CustomerRepository يتم تشغيله THEN النظام SHALL يختبر جميع عمليات CRUD للعملاء (Create, Read, Update, Delete)
2. WHEN اختبار InvoiceRepository يتم تشغيله THEN النظام SHALL يختبر جميع عمليات CRUD للفواتير
3. WHEN اختبار Repository يفشل THEN النظام SHALL يعرض رسالة خطأ واضحة تحدد المشكلة والموقع
4. WHEN جميع اختبارات Repositories تنجح THEN النظام SHALL يعرض تقرير نجاح شامل مع تفاصيل التنفيذ

### Requirement 2

**User Story:** كمطور، أريد اختبارات للـ Services، حتى أتأكد من أن منطق الأعمال يعمل بشكل صحيح.

#### Acceptance Criteria

1. WHEN اختبار AuthService يتم تشغيله THEN النظام SHALL يختبر عمليات المصادقة (تسجيل، دخول، خروج)
2. WHEN اختبار SettingsService يتم تشغيله THEN النظام SHALL يختبر عمليات الإعدادات
3. WHEN اختبار يستخدم Secure Storage THEN النظام SHALL يستخدم mock لتجنب الاعتماد على النظام الفعلي
4. WHEN اختبار يستخدم Isar THEN النظام SHALL يستخدم قاعدة بيانات في الذاكرة للاختبار

### Requirement 3

**User Story:** كمطور، أريد اختبارات للـ Widgets الأساسية، حتى أتأكد من أن الواجهات تعمل بشكل صحيح.

#### Acceptance Criteria

1. WHEN اختبار AppCard يتم تشغيله THEN النظام SHALL يتحقق من عرض المحتوى بشكل صحيح
2. WHEN اختبار AppButton يتم تشغيله THEN النظام SHALL يتحقق من استجابة الضغط
3. WHEN اختبار AppTextField يتم تشغيله THEN النظام SHALL يتحقق من إدخال النص والتحقق من الصحة
4. WHEN widget يحتوي على تفاعلات THEN النظام SHALL يختبر جميع التفاعلات الممكنة

### Requirement 4

**User Story:** كمطور، أريد إعداد بنية تحتية للاختبارات، حتى يسهل كتابة وتشغيل الاختبارات.

#### Acceptance Criteria

1. WHEN مجلد test يتم إنشاؤه THEN النظام SHALL ينظم الاختبارات بنفس بنية lib
2. WHEN helper functions للاختبارات يتم إنشاؤها THEN النظام SHALL توفر دوال مساعدة لإنشاء بيانات اختبار
3. WHEN mock objects يتم إنشاؤها THEN النظام SHALL توفر mocks لجميع الاعتماديات الخارجية
4. WHEN اختبار يحتاج بيانات THEN النظام SHALL توفر fixtures جاهزة للاستخدام

### Requirement 5

**User Story:** كمطور، أريد تشغيل جميع الاختبارات بأمر واحد، حتى أتحقق من جودة الكود بسرعة.

#### Acceptance Criteria

1. WHEN أمر flutter test يتم تشغيله THEN النظام SHALL يشغل جميع الاختبارات
2. WHEN اختبار يفشل THEN النظام SHALL يوقف التنفيذ ويعرض الخطأ
3. WHEN جميع الاختبارات تنجح THEN النظام SHALL يعرض تقرير تغطية الكود بنسبة لا تقل عن 70%
4. WHEN تقرير التغطية يتم إنشاؤه THEN النظام SHALL يعرض نسبة التغطية لكل ملف

### Requirement 6

**User Story:** كمطور، أريد اختبارات للـ Providers، حتى أتأكد من أن إدارة الحالة تعمل بشكل صحيح.

#### Acceptance Criteria

1. WHEN اختبار CustomerProvider يتم تشغيله THEN النظام SHALL يختبر تحميل وإضافة وتحديث وحذف العملاء
2. WHEN اختبار InvoiceProvider يتم تشغيله THEN النظام SHALL يختبر تحميل وإضافة وتحديث وحذف الفواتير
3. WHEN provider يتفاعل مع repository THEN النظام SHALL يستخدم mock repository
4. WHEN حالة provider تتغير THEN النظام SHALL يتحقق من أن المستمعين يتم إشعارهم

### Requirement 7

**User Story:** كمطور، أريد اختبارات للـ Models، حتى أتأكد من أن تحويل البيانات يعمل بشكل صحيح.

#### Acceptance Criteria

1. WHEN اختبار Customer model يتم تشغيله THEN النظام SHALL يختبر تحويل من/إلى JSON
2. WHEN اختبار Invoice model يتم تشغيله THEN النظام SHALL يختبر تحويل من/إلى JSON
3. WHEN model يحتوي على validation THEN النظام SHALL يختبر جميع قواعد التحقق
4. WHEN model يحتوي على computed properties THEN النظام SHALL يختبر حساب القيم بشكل صحيح

### Requirement 8

**User Story:** كمطور، أريد اختبارات للشاشات الكاملة، حتى أتأكد من أن تدفق المستخدم يعمل بشكل صحيح.

#### Acceptance Criteria

1. WHEN اختبار CustomersScreen يتم تشغيله THEN النظام SHALL يختبر عرض قائمة العملاء وإضافة عميل جديد
2. WHEN اختبار InvoicesScreen يتم تشغيله THEN النظام SHALL يختبر عرض قائمة الفواتير وإنشاء فاتورة جديدة
3. WHEN اختبار DashboardScreen يتم تشغيله THEN النظام SHALL يختبر عرض الإحصائيات والبطاقات
4. WHEN شاشة تحتوي على navigation THEN النظام SHALL يختبر التنقل بين الشاشات

### Requirement 9

**User Story:** كمطور، أريد اختبارات للخدمات الإضافية، حتى أتأكد من أن جميع الوظائف تعمل بشكل صحيح.

#### Acceptance Criteria

1. WHEN اختبار PDFService يتم تشغيله THEN النظام SHALL يختبر توليد PDF للفواتير بشكل صحيح
2. WHEN اختبار Router يتم تشغيله THEN النظام SHALL يختبر التوجيه بين الشاشات المختلفة
3. WHEN خدمة تفشل THEN النظام SHALL يتعامل مع الخطأ بشكل صحيح ويعرض رسالة مناسبة
4. WHEN PDF يتم توليده THEN النظام SHALL يتحقق من احتواء PDF على جميع بيانات الفاتورة

## أولويات التنفيذ

### المرحلة 1: الأساسيات (أسبوع 1)

- ✅ إعداد البنية التحتية (Requirement 4)
- ✅ اختبارات Models (Requirement 7)
- ✅ اختبارات Repositories (Requirement 1)

**الهدف:** بناء الأساس وضمان عمل طبقة البيانات

### المرحلة 2: منطق الأعمال (أسبوع 2)

- ✅ اختبارات Services (Requirement 2)
- ✅ اختبارات Providers (Requirement 6)

**الهدف:** ضمان عمل منطق الأعمال وإدارة الحالة

### المرحلة 3: الواجهات (أسبوع 3)

- ✅ اختبارات Widgets (Requirement 3)
- ✅ اختبارات الشاشات (Requirement 8)

**الهدف:** ضمان عمل الواجهات وتجربة المستخدم

### المرحلة 4: التكامل والتقارير (أسبوع 4)

- ✅ إعداد التشغيل والتقارير (Requirement 5)
- ✅ اختبارات الخدمات الإضافية (Requirement 9)

**الهدف:** التكامل النهائي وتحقيق التغطية المستهدفة

## معايير الجودة المستهدفة

| المعيار                    | القيمة المستهدفة | الأولوية |
| :------------------------- | :--------------- | :------- |
| **تغطية الكود الإجمالية**  | ≥ 70%            | عالية    |
| **تغطية Repositories**     | 100%             | حرجة     |
| **تغطية Services**         | 100%             | حرجة     |
| **تغطية Models**           | 100%             | حرجة     |
| **تغطية Widgets**          | ≥ 80%            | عالية    |
| **تغطية Providers**        | ≥ 90%            | عالية    |
| **تغطية Screens**          | ≥ 60%            | متوسطة   |
| **وقت تشغيل الاختبارات**   | < 30 ثانية       | عالية    |
| **معدل نجاح الاختبارات**   | 100%             | حرجة     |
| **عدد الاختبارات الفاشلة** | 0                | حرجة     |

---

**تم إعداد هذا المستند بواسطة:** فريق وكلاء تطوير مشروع بصير  
**آخر تحديث:** 2 ديسمبر 2025  
**الحالة:** ✅ معتمد ونشط
